<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KINGMAILER v4.0 - Vercel Edition</title>
    <link rel="stylesheet" href="style.css">
    <script>
        // Login check - redirect if not authenticated
        window.addEventListener('DOMContentLoaded', () => {
            const session = localStorage.getItem('kingmailer_session');
            const user = localStorage.getItem('kingmailer_user');
            if (!session || !user) {
                window.location.href = '/login.html';
            } else {
                document.getElementById('userDisplay').textContent = user;
                
                // Show admin button if admin user
                if (user === 'admin') {
                    document.getElementById('adminBtn').style.display = 'inline-block';
                }
            }
        });

        function logout() {
            localStorage.removeItem('kingmailer_session');
            localStorage.removeItem('kingmailer_user');
            window.location.href = '/login.html';
        }
    </script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>üëë KINGMAILER v4.0</h1>
            <p>Professional Email Marketing on Vercel - Full SMTP Support!</p>
            <div style="text-align: right; margin-top: 10px;">
                <span style="color: #888;">User: <span id="userDisplay">-</span></span>
                <button onclick="window.location.href='/admin.html'" id="adminBtn" style="display: none; margin-left: 15px; padding: 5px 15px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">Admin Panel</button>
                <button onclick="logout()" style="margin-left: 15px; padding: 5px 15px; background: #444; color: white; border: none; border-radius: 4px; cursor: pointer;">Logout</button>
            </div>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="send">Single Email</button>
            <button class="tab-btn" data-tab="bulk">Bulk Sending</button>
            <button class="tab-btn" data-tab="smtp">SMTP Config</button>
            <button class="tab-btn" data-tab="ses">AWS SES</button>
            <button class="tab-btn" data-tab="ec2">EC2 Relay</button>
        </div>

        <!-- Tab: Single Email -->
        <div class="tab-content active" id="send">
            <h2>üìß Send Single Email</h2>
            
            <div class="form-group">
                <label>To Email:</label>
                <input type="email" id="singleTo" placeholder="recipient@example.com">
            </div>

            <div class="form-group">
                <label>Subject:</label>
                <input type="text" id="singleSubject" placeholder="Your subject line">
            </div>

            <div class="form-group">
                <label>HTML Body:</label>
                <textarea id="singleHtml" rows="8" placeholder="<h1>Hello!</h1><p>Your HTML content here...</p>"></textarea>
            </div>

            <div class="form-group">
                <label>Send Method:</label>
                <select id="singleMethod">
                    <option value="smtp">Gmail SMTP (Recommended)</option>
                    <option value="ses">AWS SES</option>
                    <option value="ec2">EC2 Relay</option>
                </select>
            </div>

            <button class="btn btn-primary" onclick="sendSingleEmail()">Send Email</button>
            
            <div id="singleResult" class="result-box"></div>
        </div>

        <!-- Tab: Bulk Sending -->
        <div class="tab-content" id="bulk">
            <h2>üìä Bulk Email Sending</h2>
            
            <div class="info-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 20px;">
                <strong>üìß How Email Sending Works:</strong><br><br>
                ‚Ä¢ <strong>Gmail SMTP:</strong> Sends through Gmail servers (Gmail IP). Fast & reliable but may have sending limits.<br>
                ‚Ä¢ <strong>EC2 Relay:</strong> Sends from your EC2 instance IP. Better deliverability & inbox placement.<br>
                ‚Ä¢ <strong>AWS SES:</strong> Amazon's email service. Best for large volumes (10,000+ emails/day).<br><br>
                <strong>üí° Recommended:</strong> Use EC2 Relay with your created EC2 instance for best inbox delivery!
            </div>
            
            <div class="form-group">
                <label>Email List:</label>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <button class="btn btn-secondary" onclick="document.getElementById('csvFileInput').click()">üìÇ Upload CSV/TXT</button>
                    <input type="file" id="csvFileInput" accept=".csv,.txt" style="display: none;" onchange="handleFileUpload(event)">
                    <button class="btn btn-secondary" onclick="switchInputMode()">üîÑ Switch Mode</button>
                    <span id="inputModeLabel" style="padding: 8px; color: #888;">Mode: CSV Format</span>
                </div>
                <textarea id="bulkCsv" rows="8" placeholder="CSV Format:&#10;email,name,company&#10;john@example.com,John,ACME Corp&#10;jane@example.com,Jane,Tech Inc&#10;&#10;OR Simple Format (one email per line):&#10;john@example.com&#10;jane@example.com&#10;bob@example.com"></textarea>
                <small id="csvHelper">üìå CSV: Use columns in templates {{email}}, {{name}}, {{company}} | üìå Simple: Just paste emails (one per line)</small>
            </div>
            
            <div id="bulkStats" style="display: none; margin-bottom: 20px; padding: 15px; background: #2d2d2d; border-radius: 8px;">
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 15px;">
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #00ff9d;" id="totalEmails">0</div>
                        <div style="font-size: 12px; color: #888;">Total Emails</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #667eea;" id="smtpConfigured">0</div>
                        <div style="font-size: 12px; color: #888;">SMTP Configured</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #4ade80;" id="sentCount">0</div>
                        <div style="font-size: 12px; color: #888;">Sent</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #f87171;" id="failedCount">0</div>
                        <div style="font-size: 12px; color: #888;">Failed</div>
                    </div>
                </div>
                <div style="background: #1a1a1a; height: 20px; border-radius: 10px; overflow: hidden;">
                    <div id="progressBar" style="height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); width: 0%; transition: width 0.3s;"></div>
                </div>
                <div style="text-align: center; margin-top: 8px; font-size: 12px; color: #888;" id="progressText">0%</div>
            </div>

            <div class="form-group">
                <label>Subject Template:</label>
                <input type="text" id="bulkSubject" placeholder="Hello {{name}}! Offer from {{company}}">
            </div>

            <div class="form-group">
                <label>HTML Template:</label>
                <textarea id="bulkHtml" rows="8" placeholder="<h1>Hi {{name}}!</h1><p>We at {{company}} have an exciting offer...</p>"></textarea>
            </div>

            <div class="form-group">
                <label>Send Method:</label>
                <select id="bulkMethod" onchange="updateSendMethodInfo()">
                    <option value="smtp">Gmail SMTP (Gmail IP - With Account Rotation)</option>
                    <option value="ec2">EC2 Relay (Your EC2 IP - Recommended for Deliverability)</option>
                    <option value="ses">AWS SES (Amazon IP - For High Volume)</option>
                </select>
            </div>
            
            <div id="sendMethodInfo" class="info-box" style="margin-top: 10px; padding: 12px; font-size: 13px; background: #2d2d2d; border-radius: 6px;">
                <strong>‚ÑπÔ∏è Send Method Guide:</strong><br>
                <strong style="color: #00ff9d;">Gmail SMTP:</strong> Sends directly through Gmail servers. Emails appear from Gmail IP. No EC2 needed.<br>
                <strong style="color: #667eea;">EC2 Relay:</strong> Routes through your EC2 IP. Requires port <strong>3000</strong> open (relay server port). Auto-uses your SMTP accounts.<br>
                <strong style="color: #f59e0b;">AWS SES:</strong> Amazon's email service. Requires verified domain.
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Min Delay (ms):</label>
                    <input type="number" id="bulkMinDelay" value="2000" min="1000">
                </div>
                <div class="form-group">
                    <label>Max Delay (ms):</label>
                    <input type="number" id="bulkMaxDelay" value="5000" min="1000">
                </div>
            </div>

            <button class="btn btn-primary" onclick="sendBulkEmails()">Start Bulk Sending</button>
            
            <div id="bulkResult" class="result-box"></div>
        </div>

        <!-- Tab: SMTP Config -->
        <div class="tab-content" id="smtp">
            <h2>üì¨ SMTP Configuration</h2>
            
            <div class="info-box">
                <strong>‚úÖ SMTP Works on Vercel!</strong><br>
                Unlike Railway/Render, Vercel Serverless Functions have full SMTP access (ports 587/465/25).
            </div>

            <h3>Add SMTP Account</h3>
            
            <div class="form-group">
                <label>Provider:</label>
                <select id="smtpProvider">
                    <option value="gmail">Gmail (Recommended)</option>
                    <option value="custom">Custom SMTP Server</option>
                </select>
            </div>

            <div class="form-group">
                <label>Email / Username:</label>
                <input type="text" id="smtpUser" placeholder="your.email@gmail.com">
            </div>

            <div class="form-group">
                <label>Password / App Password:</label>
                <input type="password" id="smtpPass" placeholder="App Password (not your Gmail password)">
                <small>Gmail: <a href="https://myaccount.google.com/apppasswords" target="_blank">Generate App Password</a></small>
            </div>

            <div id="customSmtpFields" style="display: none;">
                <div class="form-group">
                    <label>SMTP Host:</label>
                    <input type="text" id="smtpHost" placeholder="smtp.example.com">
                </div>

                <div class="form-group">
                    <label>SMTP Port:</label>
                    <input type="number" id="smtpPort" value="587" placeholder="587">
                </div>
            </div>

            <div class="form-group">
                <label>Sender Name:</label>
                <input type="text" id="smtpSenderName" placeholder="e.g. John Doe">
                <small>This name will appear as the email sender (leave empty for default)</small>
            </div>

            <div class="form-group">
                <label>Label (optional):</label>
                <input type="text" id="smtpLabel" placeholder="My Gmail Account">
            </div>

            <button class="btn btn-secondary" onclick="testSmtpConnection()">Test Connection</button>
            <button class="btn btn-primary" onclick="addSmtpAccount()">Add Account</button>

            <div id="smtpResult" class="result-box"></div>

            <h3>Saved SMTP Accounts</h3>
            <div id="smtpAccountsList" class="accounts-list"></div>
        </div>

        <!-- Tab: AWS SES -->
        <div class="tab-content" id="ses">
            <h2>‚òÅÔ∏è AWS SES Configuration</h2>
            
            <div class="info-box">
                <strong>AWS SES Benefits:</strong><br>
                ‚Ä¢ High deliverability rate<br>
                ‚Ä¢ Low cost ($0.10 per 1000 emails)<br>
                ‚Ä¢ Handles reputation management<br>
                ‚Ä¢ Detailed analytics
            </div>

            <h3>Add SES Account</h3>
            
            <div class="form-group">
                <label>AWS Access Key ID:</label>
                <input type="text" id="sesAccessKey" placeholder="AKIAIOSFODNN7EXAMPLE">
            </div>

            <div class="form-group">
                <label>AWS Secret Access Key:</label>
                <input type="password" id="sesSecretKey" placeholder="wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY">
            </div>

            <div class="form-group">
                <label>AWS Region:</label>
                <select id="sesRegion">
                    <option value="us-east-1">US East (N. Virginia) - us-east-1</option>
                    <option value="us-west-2">US West (Oregon) - us-west-2</option>
                    <option value="eu-west-1">EU (Ireland) - eu-west-1</option>
                </select>
            </div>

            <div class="form-group">
                <label>From Email (Optional):</label>
                <input type="email" id="sesFromEmail" placeholder="noreply@yourdomain.com">
                <small>Leave empty to use default identity</small>
            </div>

            <button class="btn btn-secondary" onclick="testSesConnection()">Test Connection</button>
            <button class="btn btn-primary" onclick="addSesAccount()">Add Account</button>

            <div id="sesResult" class="result-box"></div>

            <h3>Saved SES Accounts</h3>
            <div id="sesAccountsList" class="accounts-list"></div>
        </div>

        <!-- Tab: EC2 Management -->
        <div class="tab-content" id="ec2">
            <h2>üñ•Ô∏è AWS EC2 Instance Management</h2>
            
            <div class="info-box">
                <strong>üöÄ EC2 Email Relay (JetCloudMailer Style):</strong><br>
                ‚Ä¢ Send emails FROM EC2 IP using your Gmail/Outlook SMTP accounts<br>
                ‚Ä¢ NO PORT 25 NEEDED - uses authenticated SMTP on ports 587/465<br>
                ‚Ä¢ Rotate IPs instantly while using your existing SMTP<br>
                ‚Ä¢ Requires SMTP accounts configured in "SMTP Config" tab<br>
                ‚Ä¢ Better deliverability with EC2 IP + Gmail reputation<br><br>
                <small style="color: #00ff9d;">‚úÖ No AWS port 25 request needed - works immediately!</small>
            </div>

            <h3>AWS Credentials</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label>AWS Access Key:</label>
                    <input type="text" id="ec2AccessKey" placeholder="AKIAIOSFODNN7EXAMPLE">
                </div>
                <div class="form-group">
                    <label>AWS Secret Key:</label>
                    <input type="password" id="ec2SecretKey" placeholder="wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>AWS Region:</label>
                    <select id="ec2Region">
                        <option value="us-east-1">US East (N. Virginia)</option>
                        <option value="us-west-2">US West (Oregon)</option>
                        <option value="eu-west-1">EU (Ireland)</option>
                        <option value="ap-southeast-1">Asia Pacific (Singapore)</option>
                        <option value="ap-south-1">Asia Pacific (Mumbai)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Key Pair Name:</label>
                    <input type="text" id="ec2Keypair" placeholder="my-keypair">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Security Group ID:</label>
                    <input type="text" id="ec2SecurityGroup" placeholder="sg-0123456789abcdef0">
                    <small style="color: #888;">Leave empty to create default security group</small>
                </div>
            </div>

            <button class="btn btn-secondary" onclick="saveAwsCredentials()">Save AWS Credentials</button>

            <h3 style="margin-top: 30px;">EC2 Instance Management</h3>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="createEc2Instance()">üöÄ Create New Instance</button>
                <button class="btn btn-secondary" onclick="refreshEc2Instances()">üîÑ Refresh List</button>
                <button class="btn" onclick="checkEc2Health()" style="background: linear-gradient(135deg, #1a472a 0%, #2d5016 100%);">üíö Check Health</button>
            </div>
            
            <div id="ec2HealthResult" class="result-box" style="display: none;"></div>

            <div id="ec2Result" class="result-box"></div>

            <h3>Running EC2 Instances</h3>
            <div id="ec2InstancesList"></div>

            <div class="info-box" style="margin-top: 20px;">
                <strong>How EC2 Relay Works:</strong><br>
                1. Create EC2 instance using the button above (wait 5-10 minutes for initialization)<br>
                2. Instance automatically installs Python relay server + Postfix mail server<br>
                3. Click "üíö Check Health" to verify relay server is ready<br>
                4. When sending emails via EC2 Relay method, emails originate from YOUR EC2 IP<br>
                5. NO SMTP credentials needed - uses dedicated relay server on port 8080<br>
                6. This gives you a dedicated IP for maximum inbox delivery
            </div>
        </div>
    </div>

    <footer>
        <p>KINGMAILER v4.0 - Vercel Edition | Created by <a href="https://github.com/LUCIFER14144" target="_blank">LUCIFER14144</a></p>
    </footer>

    <script src="app.js"></script>
</body>
</html>
