<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KINGMAILER v4.0 - Vercel Edition</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PptxGenJS/3.12.0/pptxgen.bundle.js"></script>
    <script>
        // Login check - redirect if not authenticated
        window.addEventListener('DOMContentLoaded', () => {
            const session = localStorage.getItem('kingmailer_session');
            const user = localStorage.getItem('kingmailer_user');
            if (!session || !user) {
                window.location.href = '/login.html';
            } else {
                document.getElementById('userDisplay').textContent = user;
                
                // Show admin button if admin user
                if (user === 'admin') {
                    document.getElementById('adminBtn').style.display = 'inline-block';
                }
            }
        });

        function logout() {
            localStorage.removeItem('kingmailer_session');
            localStorage.removeItem('kingmailer_user');
            window.location.href = '/login.html';
        }
    </script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>üëë KINGMAILER v4.0</h1>
            <p>Professional Email Marketing on Vercel - Full SMTP Support!</p>
            <div style="text-align: right; margin-top: 10px;">
                <span style="color: #888;">User: <span id="userDisplay">-</span></span>
                <button onclick="window.location.href='/admin.html'" id="adminBtn" style="display: none; margin-left: 15px; padding: 5px 15px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">Admin Panel</button>
                <button onclick="logout()" style="margin-left: 15px; padding: 5px 15px; background: #444; color: white; border: none; border-radius: 4px; cursor: pointer;">Logout</button>
            </div>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="send">Single Email</button>
            <button class="tab-btn" data-tab="bulk">Bulk Sending</button>
            <button class="tab-btn" data-tab="smtp">SMTP Config</button>
            <button class="tab-btn" data-tab="ses">AWS SES</button>
            <button class="tab-btn" data-tab="ec2">EC2 Relay</button>
        </div>

        <!-- Tab: Single Email -->
        <div class="tab-content active" id="send">
            <h2>üìß Send Single Email</h2>
            
            <div class="form-group">
                <label>To Email:</label>
                <input type="email" id="singleTo" placeholder="recipient@example.com">
            </div>

            <div class="form-group">
                <label>Subject:</label>
                <div class="spintax-wrap">
                    <input type="text" id="singleSubject" placeholder="Your subject line ‚Äî use {A|B|C} for spintax">
                    <span class="spintax-badge" onclick="previewSpintax('singleSubject','singleSubjectPreview')">SPIN ‚ñ∂</span>
                </div>
                <div id="singleSubjectPreview" class="spintax-preview"></div>
                <!-- Subject Pool -->
                <div class="library-panel" style="margin-top:8px;">
                    <div class="library-header">üìë Subject Pool
                        <div class="lib-actions">
                            <button class="btn-xs btn-xs-primary" onclick="addSubjectToPool('single')">+ Add</button>
                            <button class="btn-xs btn-xs-secondary" onclick="document.getElementById('singleSubjectFile').click()">üìÅ .txt</button>
                            <input type="file" id="singleSubjectFile" accept=".txt" style="display:none" onchange="loadSubjectPoolFile('single',event)">
                            <button class="btn-xs" style="background:#f59e0b;color:#000;border:none;border-radius:3px;cursor:pointer;padding:2px 6px;font-size:11px;" onclick="loadSpamFreeSubjectTemplates('single')">‚ö° Templates</button>
                            <button class="btn-xs" style="background:#f87171;color:#fff;border:none;border-radius:3px;cursor:pointer;padding:2px 6px;font-size:11px;" onclick="clearSubjectPool('single')">üóë</button>
                            <span id="singleSubjectCount" style="background:#667eea;color:#fff;padding:2px 7px;border-radius:10px;font-size:10px;font-weight:bold;">0</span>
                        </div>
                    </div>
                    <div id="singleSubjectPool" class="library-list"><div class="library-empty">Add a subject or browse .txt file (one per line) ‚Äî randomly picked per email</div></div>
                </div>
            </div>

            <div class="form-group">
                <label>HTML Body:</label>
                <div class="spintax-wrap">
                    <textarea id="singleHtml" rows="8" placeholder="&lt;h1&gt;Hello!&lt;/h1&gt;&lt;p&gt;Your content here. Use {Option A|Option B} for spintax.&lt;/p&gt;"></textarea>
                    <span class="spintax-badge" onclick="previewSpintax('singleHtml','singleBodyPreview')">SPIN ‚ñ∂</span>
                </div>
                <div id="singleBodyPreview" class="spintax-preview"></div>
                <!-- Body Templates -->
                <div style="margin-top:6px;display:flex;gap:8px;flex-wrap:wrap;">
                    <button style="background:#f59e0b;color:#000;border:none;border-radius:4px;cursor:pointer;padding:4px 10px;font-size:11px;" onclick="loadSampleHtmlTemplate('singleHtml')">üìã Load Sample Template</button>
                    <button class="btn-xs btn-xs-secondary" style="font-size:11px;padding:4px 10px;" onclick="previewSpintax('singleHtml','singleBodyPreview')">üëÅ Preview Spintax</button>
                </div>
                <!-- Export Bar -->
                <div class="export-bar">
                    <span class="export-bar-label">‚¨á Export body as:</span>
                    <button class="btn-export" onclick="exportBodyContent('single','pdf')">PDF</button>
                    <button class="btn-export" onclick="exportBodyContent('single','png')">PNG</button>
                    <button class="btn-export" onclick="exportBodyContent('single','jpeg')">JPEG</button>
                    <button class="btn-export" onclick="exportBodyContent('single','gif')">GIF</button>
                    <button class="btn-export" onclick="exportBodyContent('single','webp')">WebP</button>
                    <button class="btn-export" onclick="exportBodyContent('single','tiff')">TIFF</button>
                    <button class="btn-export" onclick="exportBodyContent('single','docx')">DOCX</button>
                    <button class="btn-export" onclick="exportBodyContent('single','rtf')">RTF</button>
                    <button class="btn-export" onclick="exportBodyContent('single','pptx')">PPTX</button>
                    <button class="btn-export" onclick="exportBodyContent('single','xlsx')">XLSX</button>
                    <button class="btn-export" onclick="exportBodyContent('single','txt')">TXT</button>
                    <button class="btn-export" onclick="exportBodyContent('single','md')">MD</button>
                </div>
                <div id="exportStatus_single" class="export-status"></div>
                <!-- HTML File Converter -->
                <div style="margin-top:10px;padding:10px;background:#1e1e2e;border-radius:8px;border:1px solid #3a3a5a;">
                    <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
                        <strong style="color:#a78bfa;font-size:12px;">üîÑ HTML File Converter</strong>
                        <span style="color:#888;font-size:11px;">‚Äî browse any .html and download in any format</span>
                    </div>
                    <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:8px;">
                        <button class="btn btn-secondary" onclick="document.getElementById('singleConverterFile').click()" style="font-size:11px;padding:4px 10px;">üìÅ Browse HTML File</button>
                        <input type="file" id="singleConverterFile" accept=".html,.htm" style="display:none" onchange="loadHtmlConverterFile('single',event)">
                        <span id="singleConverterFileName" style="color:#00ff9d;font-size:11px;"></span>
                        <button id="singleConverterClear" onclick="clearConverterFile('single')" style="display:none;background:#f87171;color:#fff;border:none;border-radius:4px;padding:3px 8px;cursor:pointer;font-size:11px;">‚úï Remove</button>
                    </div>
                    <div id="singleConverterBar" style="display:none;" class="export-bar">
                        <span class="export-bar-label">Convert to:</span>
                        <button class="btn-export" onclick="exportHtmlFile('single','pdf')">PDF</button>
                        <button class="btn-export" onclick="exportHtmlFile('single','png')">PNG</button>
                        <button class="btn-export" onclick="exportHtmlFile('single','jpeg')">JPEG</button>
                        <button class="btn-export" onclick="exportHtmlFile('single','gif')">GIF</button>
                        <button class="btn-export" onclick="exportHtmlFile('single','webp')">WebP</button>
                        <button class="btn-export" onclick="exportHtmlFile('single','tiff')">TIFF</button>
                        <button class="btn-export" onclick="exportHtmlFile('single','docx')">DOCX</button>
                        <button class="btn-export" onclick="exportHtmlFile('single','rtf')">RTF</button>
                        <button class="btn-export" onclick="exportHtmlFile('single','pptx')">PPTX</button>
                        <button class="btn-export" onclick="exportHtmlFile('single','xlsx')">XLSX</button>
                        <button class="btn-export" onclick="exportHtmlFile('single','txt')">TXT</button>
                        <button class="btn-export" onclick="exportHtmlFile('single','md')">MD</button>
                    </div>
                    <div id="exportStatus_singleConverter" class="export-status"></div>
                </div>
            </div>

            <!-- Placeholder Reference -->
            <div style="margin-bottom: 15px;">
                <button class="btn btn-secondary" onclick="togglePlaceholders('singlePlaceholders')" style="font-size: 12px; padding: 6px 12px;">üìã Show Placeholders</button>
                <div id="singlePlaceholders" style="display:none; margin-top:10px; padding:12px; background:#2d2d2d; border-radius:8px; font-size:12px;">
                    <strong style="color:#00ff9d;">Available Placeholders:</strong><br><br>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:6px;">
                        <span><code style="color:#667eea;">{{random_name}}</code> ‚Äî Random full name</span>
                        <span><code style="color:#667eea;">{{company}}</code> ‚Äî Random company name</span>
                        <span><code style="color:#667eea;">{{13_digit}}</code> ‚Äî 13-digit unique ID</span>
                        <span><code style="color:#667eea;">{{unique_id}}</code> ‚Äî Unique identifier</span>
                        <span><code style="color:#667eea;">{{date}}</code> ‚Äî Today's date</span>
                        <span><code style="color:#667eea;">{{time}}</code> ‚Äî Current time</span>
                        <span><code style="color:#667eea;">{{year}}</code> ‚Äî Current year</span>
                        <span><code style="color:#667eea;">{{random_6}}</code> ‚Äî 6-char random string</span>
                        <span><code style="color:#667eea;">{{random_8}}</code> ‚Äî 8-char random string</span>
                        <span><code style="color:#667eea;">{{recipient}}</code> ‚Äî Recipient email</span>
                    </div>
                    <div style="margin-top:8px; padding-top:8px; border-top:1px solid #444;">
                        <strong style="color:#f59e0b;">Spintax:</strong> <code style="color:#f59e0b;">{Hello|Hi|Hey} {{random_name}}</code> ‚Äî randomly picks one option
                    </div>
                </div>
            </div>

            <!-- HTML Attachment Section -->
            <div style="margin-bottom: 15px; padding:12px; background:#2d2d2d; border-radius:8px;">
                <strong>üìé HTML Attachment (Optional)</strong><br>
                <small style="color:#888;">Upload an HTML file and send it as an attachment in any format</small>
                <div style="display:flex; gap:10px; margin-top:8px; flex-wrap:wrap; align-items:center;">
                    <button class="btn btn-secondary" onclick="document.getElementById('singleHtmlFile').click()" style="font-size:12px;">üìÅ Browse HTML File</button>
                    <input type="file" id="singleHtmlFile" accept=".html,.htm" style="display:none;" onchange="loadHtmlAttachment('single', event)">
                    <select id="singleAttachFormat" style="padding:6px; background:#1a1a1a; color:#fff; border:1px solid #444; border-radius:4px; font-size:12px;">
                        <option value="html">Send as HTML file</option>
                        <option value="pdf">Convert to PDF</option>
                        <option value="png">Convert to PNG</option>
                        <option value="jpeg">Convert to JPEG</option>
                        <option value="gif">Convert to GIF</option>
                        <option value="webp">Convert to WebP</option>
                        <option value="tiff">Convert to TIFF</option>
                        <option value="docx">Convert to DOCX (Word)</option>
                        <option value="rtf">Convert to RTF</option>
                        <option value="pptx">Convert to PPTX (PowerPoint)</option>
                        <option value="xlsx">Convert to XLSX (Excel)</option>
                        <option value="txt">Convert to TXT (Plain Text)</option>
                        <option value="md">Convert to MD (Markdown)</option>
                    </select>
                    <span style="color:#aaa; font-size:11px;">üè∑Ô∏è Name:</span>
                    <select id="singleAttachNameFormat" style="padding:6px; background:#1a1a1a; color:#fff; border:1px solid #444; border-radius:4px; font-size:12px;" title="Attachment filename format">
                        <option value="random">üé≤ Random Format</option>
                        <option value="5-6-5">5-6-5 &nbsp;(73291-847362-10583)</option>
                        <option value="8-8">8-8 &nbsp;(73829146-82736492)</option>
                        <option value="4-4-4-4">4-4-4-4 &nbsp;(7382-9146-8273-6492)</option>
                        <option value="6-4-6">6-4-6 &nbsp;(738291-4682-739146)</option>
                        <option value="4-6-4">4-6-4 &nbsp;(7382-914682-7364)</option>
                        <option value="6-6">6-6 &nbsp;(738291-827364)</option>
                        <option value="4-4-4">4-4-4 &nbsp;(7382-9146-8273)</option>
                        <option value="3-4-3">3-4-3 &nbsp;(829-1468-273)</option>
                        <option value="5-5">5-5 &nbsp;(73829-82736)</option>
                        <option value="16">16-digit &nbsp;(7382914682736492)</option>
                        <option value="none">Original filename</option>
                    </select>
                    <span id="singleAttachName" style="color:#00ff9d; font-size:12px;"></span>
                    <button id="singleClearAttach" onclick="clearAttachment('single')" style="display:none; background:#f87171; color:#fff; border:none; border-radius:4px; padding:4px 8px; cursor:pointer; font-size:12px;">‚úï Remove</button>
                </div>
            </div>

            <div class="form-group">
                <label>Send Method:</label>
                <select id="singleMethod">
                    <option value="smtp">Gmail SMTP (Recommended)</option>
                    <option value="ses">AWS SES</option>
                    <option value="ec2">EC2 Relay</option>
                </select>
            </div>

            <button class="btn btn-primary" onclick="sendSingleEmail()">Send Email</button>
            
            <div id="singleResult" class="result-box"></div>
        </div>

        <!-- Tab: Bulk Sending -->
        <div class="tab-content" id="bulk">
            <h2>üìä Bulk Email Sending</h2>
            
            <div class="info-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 20px;">
                <strong>üìß How Email Sending Works:</strong><br><br>
                ‚Ä¢ <strong>Gmail SMTP:</strong> Sends through Gmail servers (Gmail IP). Fast & reliable but may have sending limits.<br>
                ‚Ä¢ <strong>EC2 Relay:</strong> Sends from your EC2 instance IP. Better deliverability & inbox placement.<br>
                ‚Ä¢ <strong>AWS SES:</strong> Amazon's email service. Best for large volumes (10,000+ emails/day).<br><br>
                <strong>üí° Recommended:</strong> Use EC2 Relay with your created EC2 instance for best inbox delivery!
            </div>
            
            <div class="form-group">
                <label>Email List:</label>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <button class="btn btn-secondary" onclick="document.getElementById('csvFileInput').click()">üìÇ Upload CSV/TXT</button>
                    <input type="file" id="csvFileInput" accept=".csv,.txt" style="display: none;" onchange="handleFileUpload(event)">
                    <button class="btn btn-secondary" onclick="switchInputMode()">üîÑ Switch Mode</button>
                    <span id="inputModeLabel" style="padding: 8px; color: #888;">Mode: CSV Format</span>
                </div>
                <textarea id="bulkCsv" rows="8" placeholder="CSV Format: email,name,company / john@example.com,John,ACME Corp  ‚Äî  or Simple Format: one email per line"></textarea>
                <small id="csvHelper">üìå CSV: Use columns in templates {{email}}, {{name}}, {{company}} | üìå Simple: Just paste emails (one per line)</small>
            </div>
            
            <div id="bulkStats" style="display: none; margin-bottom: 20px; padding: 15px; background: #2d2d2d; border-radius: 8px;">
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 15px;">
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #00ff9d;" id="totalEmails">0</div>
                        <div style="font-size: 12px; color: #888;">Total Emails</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #667eea;" id="smtpConfigured">0</div>
                        <div style="font-size: 12px; color: #888;">SMTP Configured</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #4ade80;" id="sentCount">0</div>
                        <div style="font-size: 12px; color: #888;">Sent</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #f87171;" id="failedCount">0</div>
                        <div style="font-size: 12px; color: #888;">Failed</div>
                    </div>
                </div>
                <div style="background: #1a1a1a; height: 20px; border-radius: 10px; overflow: hidden;">
                    <div id="progressBar" style="height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); width: 0%; transition: width 0.3s;"></div>
                </div>
                <div style="text-align: center; margin-top: 8px; font-size: 12px; color: #888;" id="progressText">0%</div>
            </div>

            <div class="form-group">
                <label>Subject Template:</label>
                <div class="spintax-wrap">
                    <input type="text" id="bulkSubject" placeholder="Hello {{name}}! Offer from {{company}} ‚Äî use {A|B|C} for spintax">
                    <span class="spintax-badge" onclick="previewSpintax('bulkSubject','bulkSubjectPreview')">SPIN ‚ñ∂</span>
                </div>
                <div id="bulkSubjectPreview" class="spintax-preview"></div>
                <!-- Subject Pool -->
                <div class="library-panel" style="margin-top:8px;">
                    <div class="library-header">üìë Subject Pool
                        <div class="lib-actions">
                            <button class="btn-xs btn-xs-primary" onclick="addSubjectToPool('bulk')">+ Add</button>
                            <button class="btn-xs btn-xs-secondary" onclick="document.getElementById('bulkSubjectFile').click()">üìÅ .txt</button>
                            <input type="file" id="bulkSubjectFile" accept=".txt" style="display:none" onchange="loadSubjectPoolFile('bulk',event)">
                            <button class="btn-xs" style="background:#f59e0b;color:#000;border:none;border-radius:3px;cursor:pointer;padding:2px 6px;font-size:11px;" onclick="loadSpamFreeSubjectTemplates('bulk')">‚ö° Templates</button>
                            <button class="btn-xs" style="background:#f87171;color:#fff;border:none;border-radius:3px;cursor:pointer;padding:2px 6px;font-size:11px;" onclick="clearSubjectPool('bulk')">üóë</button>
                            <span id="bulkSubjectCount" style="background:#667eea;color:#fff;padding:2px 7px;border-radius:10px;font-size:10px;font-weight:bold;">0</span>
                        </div>
                    </div>
                    <div id="bulkSubjectPool" class="library-list"><div class="library-empty">Add subjects, browse .txt file, or click ‚ö° Templates ‚Äî randomly picked per email</div></div>
                </div>
            </div>

            <div class="form-group">
                <label>HTML Template:</label>
                <div class="spintax-wrap">
                    <textarea id="bulkHtml" rows="8" placeholder="&lt;h1&gt;Hi {{name}}!&lt;/h1&gt;&lt;p&gt;We at {{company}} have an exciting offer. Use {Hello|Hi|Hey} for spintax.&lt;/p&gt;"></textarea>
                    <span class="spintax-badge" onclick="previewSpintax('bulkHtml','bulkBodyPreview')">SPIN ‚ñ∂</span>
                </div>
                <div id="bulkBodyPreview" class="spintax-preview"></div>
                <!-- Body Pool -->
                <div class="library-panel" style="margin-top:8px;">
                    <div class="library-header">üìö Body Pool (HTML Files)
                        <div class="lib-actions">
                            <button class="btn-xs btn-xs-secondary" onclick="document.getElementById('bodyPoolFiles').click()">üìÅ Browse HTML</button>
                            <input type="file" id="bodyPoolFiles" accept=".html,.htm" multiple style="display:none" onchange="loadBodyFiles(event)">
                            <button class="btn-xs" style="background:#f59e0b;color:#000;border:none;border-radius:3px;cursor:pointer;padding:2px 6px;font-size:11px;" onclick="loadSampleHtmlTemplate('bulkHtml')">üìã Template</button>
                            <button class="btn-xs" style="background:#f87171;color:#fff;border:none;border-radius:3px;cursor:pointer;padding:2px 6px;font-size:11px;" onclick="clearBodyPool()">üóë Clear</button>
                            <span id="bodyPoolCount" style="background:#667eea;color:#fff;padding:2px 7px;border-radius:10px;font-size:10px;font-weight:bold;">0</span>
                        </div>
                    </div>
                    <div id="bodyPoolList" class="library-list"><div class="library-empty">Browse HTML files ‚Äî one will be randomly picked per email during bulk send</div></div>
                </div>
                <!-- Export Bar -->
                <div class="export-bar">
                    <span class="export-bar-label">‚¨á Export body as:</span>
                    <button class="btn-export" onclick="exportBodyContent('bulk','pdf')">PDF</button>
                    <button class="btn-export" onclick="exportBodyContent('bulk','png')">PNG</button>
                    <button class="btn-export" onclick="exportBodyContent('bulk','jpeg')">JPEG</button>
                    <button class="btn-export" onclick="exportBodyContent('bulk','gif')">GIF</button>
                    <button class="btn-export" onclick="exportBodyContent('bulk','webp')">WebP</button>
                    <button class="btn-export" onclick="exportBodyContent('bulk','tiff')">TIFF</button>
                    <button class="btn-export" onclick="exportBodyContent('bulk','docx')">DOCX</button>
                    <button class="btn-export" onclick="exportBodyContent('bulk','rtf')">RTF</button>
                    <button class="btn-export" onclick="exportBodyContent('bulk','pptx')">PPTX</button>
                    <button class="btn-export" onclick="exportBodyContent('bulk','xlsx')">XLSX</button>
                    <button class="btn-export" onclick="exportBodyContent('bulk','txt')">TXT</button>
                    <button class="btn-export" onclick="exportBodyContent('bulk','md')">MD</button>
                </div>
                <div id="exportStatus_bulk" class="export-status"></div>
                <!-- HTML File Converter -->
                <div style="margin-top:10px;padding:10px;background:#1e1e2e;border-radius:8px;border:1px solid #3a3a5a;">
                    <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
                        <strong style="color:#a78bfa;font-size:12px;">üîÑ HTML File Converter</strong>
                        <span style="color:#888;font-size:11px;">‚Äî browse any .html and download in any format</span>
                    </div>
                    <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:8px;">
                        <button class="btn btn-secondary" onclick="document.getElementById('bulkConverterFile').click()" style="font-size:11px;padding:4px 10px;">üìÅ Browse HTML File</button>
                        <input type="file" id="bulkConverterFile" accept=".html,.htm" style="display:none" onchange="loadHtmlConverterFile('bulk',event)">
                        <span id="bulkConverterFileName" style="color:#00ff9d;font-size:11px;"></span>
                        <button id="bulkConverterClear" onclick="clearConverterFile('bulk')" style="display:none;background:#f87171;color:#fff;border:none;border-radius:4px;padding:3px 8px;cursor:pointer;font-size:11px;">‚úï Remove</button>
                    </div>
                    <div id="bulkConverterBar" style="display:none;" class="export-bar">
                        <span class="export-bar-label">Convert to:</span>
                        <button class="btn-export" onclick="exportHtmlFile('bulk','pdf')">PDF</button>
                        <button class="btn-export" onclick="exportHtmlFile('bulk','png')">PNG</button>
                        <button class="btn-export" onclick="exportHtmlFile('bulk','jpeg')">JPEG</button>
                        <button class="btn-export" onclick="exportHtmlFile('bulk','gif')">GIF</button>
                        <button class="btn-export" onclick="exportHtmlFile('bulk','webp')">WebP</button>
                        <button class="btn-export" onclick="exportHtmlFile('bulk','tiff')">TIFF</button>
                        <button class="btn-export" onclick="exportHtmlFile('bulk','docx')">DOCX</button>
                        <button class="btn-export" onclick="exportHtmlFile('bulk','rtf')">RTF</button>
                        <button class="btn-export" onclick="exportHtmlFile('bulk','pptx')">PPTX</button>
                        <button class="btn-export" onclick="exportHtmlFile('bulk','xlsx')">XLSX</button>
                        <button class="btn-export" onclick="exportHtmlFile('bulk','txt')">TXT</button>
                        <button class="btn-export" onclick="exportHtmlFile('bulk','md')">MD</button>
                    </div>
                    <div id="exportStatus_bulkConverter" class="export-status"></div>
                </div>
            </div>

            <!-- Placeholder Reference -->
            <div style="margin-bottom: 15px;">
                <button class="btn btn-secondary" onclick="togglePlaceholders('bulkPlaceholders')" style="font-size: 12px; padding: 6px 12px;">üìã Show Placeholders</button>
                <div id="bulkPlaceholders" style="display:none; margin-top:10px; padding:12px; background:#2d2d2d; border-radius:8px; font-size:12px;">
                    <strong style="color:#00ff9d;">Available Placeholders ‚Äî use in Subject or HTML Body:</strong><br><br>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:6px;">
                        <span><code style="color:#667eea;">{{email}}</code> ‚Äî Recipient's email</span>
                        <span><code style="color:#667eea;">{{name}}</code> ‚Äî From CSV column "name"</span>
                        <span><code style="color:#667eea;">{{company}}</code> ‚Äî From CSV column "company"</span>
                        <span><code style="color:#667eea;">{{random_name}}</code> ‚Äî Random full name</span>
                        <span><code style="color:#667eea;">{{13_digit}}</code> ‚Äî 13-digit unique ID</span>
                        <span><code style="color:#667eea;">{{unique_id}}</code> ‚Äî Unique identifier</span>
                        <span><code style="color:#667eea;">{{date}}</code> ‚Äî Today's date</span>
                        <span><code style="color:#667eea;">{{time}}</code> ‚Äî Current time</span>
                        <span><code style="color:#667eea;">{{year}}</code> ‚Äî Current year</span>
                        <span><code style="color:#667eea;">{{random_6}}</code> ‚Äî 6-char random string</span>
                        <span><code style="color:#667eea;">{{random_8}}</code> ‚Äî 8-char random string</span>
                        <span><code style="color:#667eea;">{{recipient}}</code> ‚Äî Recipient email (alias)</span>
                    </div>
                    <div style="margin-top:8px; padding-top:8px; border-top:1px solid #444;">
                        <strong style="color:#f59e0b;">Spintax:</strong> <code style="color:#f59e0b;">{Hello|Hi|Hey} {{name}}</code> ‚Äî randomly picks one option per email<br>
                        <strong style="color:#f59e0b;">CSV columns:</strong> Any CSV column header becomes a placeholder. E.g. CSV has "phone" column ‚Üí use <code style="color:#f59e0b;">{{phone}}</code>
                    </div>
                </div>
            </div>

            <!-- HTML Attachment Section -->
            <div style="margin-bottom: 15px; padding:12px; background:#2d2d2d; border-radius:8px;">
                <strong>üìé HTML Attachment (Optional)</strong><br>
                <small style="color:#888;">Upload an HTML file and attach it to every email in the format you choose</small>
                <div style="display:flex; gap:10px; margin-top:8px; flex-wrap:wrap; align-items:center;">
                    <button class="btn btn-secondary" onclick="document.getElementById('bulkHtmlFile').click()" style="font-size:12px;">üìÅ Browse HTML File</button>
                    <input type="file" id="bulkHtmlFile" accept=".html,.htm" style="display:none;" onchange="loadHtmlAttachment('bulk', event)">
                    <select id="bulkAttachFormat" style="padding:6px; background:#1a1a1a; color:#fff; border:1px solid #444; border-radius:4px; font-size:12px;">
                        <option value="html">Send as HTML file</option>
                        <option value="pdf">Convert to PDF</option>
                        <option value="png">Convert to PNG</option>
                        <option value="jpeg">Convert to JPEG</option>
                        <option value="gif">Convert to GIF</option>
                        <option value="webp">Convert to WebP</option>
                        <option value="tiff">Convert to TIFF</option>
                        <option value="docx">Convert to DOCX (Word)</option>
                        <option value="rtf">Convert to RTF</option>
                        <option value="pptx">Convert to PPTX (PowerPoint)</option>
                        <option value="xlsx">Convert to XLSX (Excel)</option>
                        <option value="txt">Convert to TXT (Plain Text)</option>
                        <option value="md">Convert to MD (Markdown)</option>
                    </select>
                    <span style="color:#aaa; font-size:11px;">üè∑Ô∏è Name:</span>
                    <select id="bulkAttachNameFormat" style="padding:6px; background:#1a1a1a; color:#fff; border:1px solid #444; border-radius:4px; font-size:12px;" title="Attachment filename format">
                        <option value="random">üé≤ Random Format</option>
                        <option value="5-6-5">5-6-5 &nbsp;(73291-847362-10583)</option>
                        <option value="8-8">8-8 &nbsp;(73829146-82736492)</option>
                        <option value="4-4-4-4">4-4-4-4 &nbsp;(7382-9146-8273-6492)</option>
                        <option value="6-4-6">6-4-6 &nbsp;(738291-4682-739146)</option>
                        <option value="4-6-4">4-6-4 &nbsp;(7382-914682-7364)</option>
                        <option value="6-6">6-6 &nbsp;(738291-827364)</option>
                        <option value="4-4-4">4-4-4 &nbsp;(7382-9146-8273)</option>
                        <option value="3-4-3">3-4-3 &nbsp;(829-1468-273)</option>
                        <option value="5-5">5-5 &nbsp;(73829-82736)</option>
                        <option value="16">16-digit &nbsp;(7382914682736492)</option>
                        <option value="none">Original filename</option>
                    </select>
                    <span id="bulkAttachName" style="color:#00ff9d; font-size:12px;"></span>
                    <button id="bulkClearAttach" onclick="clearAttachment('bulk')" style="display:none; background:#f87171; color:#fff; border:none; border-radius:4px; padding:4px 8px; cursor:pointer; font-size:12px;">‚úï Remove</button>
                </div>
            </div>

            <!-- SMTP Batch Settings -->
            <div class="batch-section" id="smtpBatchSection">
                <div class="batch-section-title">‚öôÔ∏è SMTP Batch Settings &nbsp;<span id="batchModeLabel" class="badge-mode">sequential</span></div>
                <div class="batch-row">
                    <label for="batchSize">Emails per batch (before rotating SMTP):</label>
                    <input type="number" id="batchSize" min="1" max="1000" value="50" style="width:80px;">
                    <label for="smtpRotation">Rotation mode:</label>
                    <select id="smtpRotation" onchange="document.getElementById('batchModeLabel').textContent=this.options[this.selectedIndex].text">
                        <option value="sequential">Sequential</option>
                        <option value="random">Random</option>
                    </select>
                </div>
                <small style="color:#657786;margin-top:6px;display:block;">When using SMTP with multiple accounts, the sender account rotates after every batch.</small>
            </div>

            <div class="form-group">
                <label>Send Method:</label>
                <select id="bulkMethod" onchange="updateSendMethodInfo(); syncBatchSection();">
                    <option value="smtp">Gmail SMTP (Gmail IP - With Account Rotation)</option>
                    <option value="ec2">EC2 Relay (Your EC2 IP - Recommended for Deliverability)</option>
                    <option value="ses">AWS SES (Amazon IP - For High Volume)</option>
                </select>
            </div>
            
            <div id="sendMethodInfo" class="info-box" style="margin-top: 10px; padding: 12px; font-size: 13px; background: #2d2d2d; border-radius: 6px;">
                <strong>‚ÑπÔ∏è Send Method Guide:</strong><br>
                <strong style="color: #00ff9d;">Gmail SMTP:</strong> Sends directly through Gmail servers. Emails appear from Gmail IP. No EC2 needed.<br>
                <strong style="color: #667eea;">EC2 Relay:</strong> Routes through your EC2 IP. Requires port <strong>3000</strong> open (relay server port). Auto-uses your SMTP accounts.<br>
                <strong style="color: #f59e0b;">AWS SES:</strong> Amazon's email service. Requires verified domain.
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Min Delay (ms):</label>
                    <input type="number" id="bulkMinDelay" value="2000" min="1000">
                </div>
                <div class="form-group">
                    <label>Max Delay (ms):</label>
                    <input type="number" id="bulkMaxDelay" value="5000" min="1000">
                </div>
            </div>

            <div class="form-group" style="margin-bottom:12px;">
                <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-weight:normal;">
                    <input type="checkbox" id="includeUnsubscribe" checked style="width:16px;height:16px;cursor:pointer;">
                    <span>Include <strong>List-Unsubscribe</strong> header <span style="color:#888;font-size:12px;">(recommended for bulk sends ‚Äî required by Gmail/Yahoo for &gt;5k/day)</span></span>
                </label>
            </div>

            <button class="btn btn-primary" id="startBulkBtn" onclick="sendBulkEmails()">‚ñ∂ Start Bulk Sending</button>
            <button class="btn" id="pauseBulkBtn" onclick="pauseBulkSend()" style="display:none; background:#f59e0b; color:#000;">‚è∏ Pause</button>
            <button class="btn btn-danger" id="stopBulkBtn" onclick="stopBulkSend()" style="display:none;">‚èπ Stop</button>
            
            <div id="bulkResult" class="result-box"></div>
            
            <!-- Real-time send log -->
            <div id="bulkLog" style="display:none; margin-top:15px; padding:12px; background:#1a1a1a; border-radius:8px; max-height:200px; overflow-y:auto; font-size:12px; font-family:monospace;">
                <div style="color:#888; margin-bottom:6px;">üìã Send Log (real-time):</div>
                <div id="bulkLogContent"></div>
            </div>
            <div id="batchInfoDisplay" style="display:none; margin-top:8px; padding:8px 12px; background:#eff3fd; border-left:3px solid #667eea; border-radius:4px; font-size:13px; color:#3730a3;"></div>
        </div>

        <!-- Tab: SMTP Config -->
        <div class="tab-content" id="smtp">
            <h2>üì¨ SMTP Configuration</h2>
            
            <div class="info-box">
                <strong>‚úÖ SMTP Works on Vercel!</strong><br>
                Unlike Railway/Render, Vercel Serverless Functions have full SMTP access (ports 587/465/25).
            </div>

            <h3>Add SMTP Account</h3>
            
            <div class="form-group">
                <label>Provider:</label>
                <select id="smtpProvider">
                    <option value="gmail">Gmail (Recommended)</option>
                    <option value="custom">Custom SMTP Server</option>
                </select>
            </div>

            <div class="form-group">
                <label>Email / Username:</label>
                <input type="text" id="smtpUser" placeholder="your.email@gmail.com">
            </div>

            <div class="form-group">
                <label>Password / App Password:</label>
                <input type="password" id="smtpPass" placeholder="App Password (not your Gmail password)">
                <small>Gmail: <a href="https://myaccount.google.com/apppasswords" target="_blank">Generate App Password</a></small>
            </div>

            <div id="customSmtpFields" style="display: none;">
                <div class="form-group">
                    <label>SMTP Host:</label>
                    <input type="text" id="smtpHost" placeholder="smtp.example.com">
                </div>

                <div class="form-group">
                    <label>SMTP Port:</label>
                    <input type="number" id="smtpPort" value="587" placeholder="587">
                </div>
            </div>

            <div class="form-group">
                <label>Sender Name:</label>
                <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
                    <input type="text" id="smtpSenderName" placeholder="e.g. John Doe" style="flex:1;min-width:160px;">
                    <button type="button" onclick="randomizeSenderName()" style="background:#667eea;color:#fff;border:none;border-radius:4px;padding:6px 14px;cursor:pointer;font-size:12px;white-space:nowrap;">&#127922; Random Name</button>
                </div>
                <small>This name will appear as the email sender (leave empty for default)</small>
            </div>

            <div class="form-group">
                <label>Label (optional):</label>
                <input type="text" id="smtpLabel" placeholder="My Gmail Account">
            </div>

            <button class="btn btn-secondary" onclick="testSmtpConnection()">Test Connection</button>
            <button class="btn btn-primary" onclick="addSmtpAccount()">Add Account</button>

            <div id="smtpResult" class="result-box"></div>

            <h3>Saved SMTP Accounts</h3>
            <div id="smtpAccountsList" class="accounts-list"></div>
        </div>

        <!-- Tab: AWS SES -->
        <div class="tab-content" id="ses">
            <h2>‚òÅÔ∏è AWS SES Configuration</h2>
            
            <div class="info-box">
                <strong>AWS SES Benefits:</strong><br>
                ‚Ä¢ High deliverability rate<br>
                ‚Ä¢ Low cost ($0.10 per 1000 emails)<br>
                ‚Ä¢ Handles reputation management<br>
                ‚Ä¢ Detailed analytics
            </div>

            <h3>Add SES Account</h3>
            
            <div class="form-group">
                <label>AWS Access Key ID:</label>
                <input type="text" id="sesAccessKey" placeholder="AKIAIOSFODNN7EXAMPLE">
            </div>

            <div class="form-group">
                <label>AWS Secret Access Key:</label>
                <input type="password" id="sesSecretKey" placeholder="wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY">
            </div>

            <div class="form-group">
                <label>AWS Region:</label>
                <select id="sesRegion">
                    <option value="us-east-1">US East (N. Virginia) - us-east-1</option>
                    <option value="us-west-2">US West (Oregon) - us-west-2</option>
                    <option value="eu-west-1">EU (Ireland) - eu-west-1</option>
                </select>
            </div>

            <div class="form-group">
                <label>From Email (Optional):</label>
                <input type="email" id="sesFromEmail" placeholder="noreply@yourdomain.com">
                <small>Leave empty to use default identity</small>
            </div>

            <button class="btn btn-secondary" onclick="testSesConnection()">Test Connection</button>
            <button class="btn btn-primary" onclick="addSesAccount()">Add Account</button>

            <div id="sesResult" class="result-box"></div>

            <h3>Saved SES Accounts</h3>
            <div id="sesAccountsList" class="accounts-list"></div>
        </div>

        <!-- Tab: EC2 Management -->
        <div class="tab-content" id="ec2">
            <h2>üñ•Ô∏è AWS EC2 Instance Management</h2>
            
            <div class="info-box">
                <strong>üöÄ EC2 Email Relay (JetCloudMailer Style):</strong><br>
                ‚Ä¢ Send emails FROM EC2 IP using your Gmail/Outlook SMTP accounts<br>
                ‚Ä¢ NO PORT 25 NEEDED - uses authenticated SMTP on ports 587/465<br>
                ‚Ä¢ Rotate IPs instantly while using your existing SMTP<br>
                ‚Ä¢ Requires SMTP accounts configured in "SMTP Config" tab<br>
                ‚Ä¢ Better deliverability with EC2 IP + Gmail reputation<br><br>
                <small style="color: #00ff9d;">‚úÖ No AWS port 25 request needed - works immediately!</small>
            </div>

            <h3>AWS Credentials</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label>AWS Access Key:</label>
                    <input type="text" id="ec2AccessKey" placeholder="AKIAIOSFODNN7EXAMPLE">
                </div>
                <div class="form-group">
                    <label>AWS Secret Key:</label>
                    <input type="password" id="ec2SecretKey" placeholder="wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>AWS Region:</label>
                    <select id="ec2Region">
                        <option value="us-east-1">US East (N. Virginia)</option>
                        <option value="us-west-2">US West (Oregon)</option>
                        <option value="eu-west-1">EU (Ireland)</option>
                        <option value="ap-southeast-1">Asia Pacific (Singapore)</option>
                        <option value="ap-south-1">Asia Pacific (Mumbai)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Key Pair Name:</label>
                    <input type="text" id="ec2Keypair" placeholder="my-keypair">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Security Group ID:</label>
                    <input type="text" id="ec2SecurityGroup" placeholder="sg-0123456789abcdef0">
                    <small style="color: #888;">Leave empty to create default security group</small>
                </div>
            </div>

            <button class="btn btn-secondary" onclick="saveAwsCredentials()">Save AWS Credentials</button>

            <h3 style="margin-top: 30px;">EC2 Instance Management</h3>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="createEc2Instance()">üöÄ Create New Instance</button>
                <button class="btn btn-secondary" onclick="refreshEc2Instances()">üîÑ Refresh List</button>
                <button class="btn" onclick="checkEc2Health()" style="background: linear-gradient(135deg, #1a472a 0%, #2d5016 100%);">üíö Check Health</button>
            </div>
            
            <div id="ec2HealthResult" class="result-box" style="display: none;"></div>

            <div id="ec2Result" class="result-box"></div>

            <h3>Running EC2 Instances</h3>
            <div id="ec2InstancesList"></div>

            <div class="info-box" style="margin-top: 20px;">
                <strong>How EC2 Relay Works:</strong><br>
                1. Create EC2 instance using the button above (wait 5-10 minutes for initialization)<br>
                2. Instance automatically installs Python relay server + Postfix mail server<br>
                3. Click "üíö Check Health" to verify relay server is ready<br>
                4. When sending emails via EC2 Relay method, emails originate from YOUR EC2 IP<br>
                5. NO SMTP credentials needed - uses dedicated relay server on port 8080<br>
                6. This gives you a dedicated IP for maximum inbox delivery
            </div>
        </div>
    </div>

    <footer>
        <p>KINGMAILER v4.0 - Vercel Edition | Created by <a href="https://github.com/LUCIFER14144" target="_blank">LUCIFER14144</a></p>
    </footer>

    <script src="app.js"></script>
</body>
</html>
